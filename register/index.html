<head>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="./register.css" />
    <link rel="stylesheet" href="/lib/toast.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>
    <main>
        <div id="left">
            <img
                src="./public/logo.png"
            />
            <h1> Sign Up </h1>
            <form id="register">
                <input
                    type="text"
                    id="firstName"
                    name="firstName"
                    placeholder="First Name"
                    required
                />
                <input
                    type="text"
                    id="lastName"
                    name="lastName"
                    placeholder="Last Name"
                    required
                />
                <input
                    type="text"
                    id="email"
                    name="email"
                    placeholder="Email Address"
                    required
                />
                <input
                    type="password"
                    id="password"
                    name="password"
                    placeholder="Password"
                    required
                />
                <section>
                    <input
                        type="checkbox"
                        id="conditions"
                        name="conditions"
                        required
                    />
                    <label for="conditions">Accept Terms and Conditions</label>
                </section>

                <button type="submit">Register now</button>
            </form>
        </div>
        <div id="right">
            <img src="./public/media.jpg"/>
        </div>
    </main>
    <script src="/lib/toast.js"></script>
    <script>
        const form = document.getElementById('register');
        form.addEventListener('submit', async (event) => {
          event.preventDefault();

          const firstName = document.getElementById('firstName').value;
          const lastName = document.getElementById('lastName').value;
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;

          const query = `
            mutation CreateUser(
            $firstName: String!,
            $lastName: String!,
            $email: String!,
            $password: String!) {
              createUser(data: { firstName: $firstName, lastName: $lastName, email: $email, password: $password }) {
                id
                firstName
                email
              }
            }
          `;

          const variables = { firstName, lastName, email, password };

          try {
            const response = await fetch('http://api.eternityready.com/api/graphql', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ query, variables }),
            });

            const result = await response.json();

            if (result.errors) {
              console.error('Error creating user:', result.errors);
              document.body.appendChild(sfToast(
                "Error", `Error creating user: ${result.errors[0].message}`, "error"
              ));

            } else {
              document.body.appendChild(sfToast(
                "Success", `User created successfully: ${email}. Redirecting...`, "success"
              ));
              window.location.assign("https://eternityready.com/login");

            }
          } catch (error) {
            console.error('Network error:', error);
            document.body.appendChild(sfToast(
              "Error", error.message, "error"
            ));
          }
        });
    </script>
</body>
